# ============================================================
# Makefile - Avalia√ß√£o 2 - HPC I
# Vers√£o: C√≥digo Serial FINAL (todas otimiza√ß√µes manuais)
# Autora: Vanessa Gomes Martins da Silva (UFF)
# ============================================================

# Compilador Fortran
FC = gfortran

# ------------------------------------------------------------
# Flags de compila√ß√£o
# ------------------------------------------------------------
# Para executar com:
#   make O0  -> compila SEM otimiza√ß√£o do compilador
#   make O2  -> compila COM otimiza√ß√£o do compilador (-O2)
# ------------------------------------------------------------

FFLAGS_O0 = -O0 -Wall -fcheck=all -fbacktrace
FFLAGS_O2 = -O2 -march=native -funroll-loops -Wall -fbacktrace

# Nome do execut√°vel (definido de acordo com o modo)
EXEC_O0 = trafego_versao_final_O0
EXEC_O2 = trafego_versao_final_O2

# Objetos necess√°rios (cada m√≥dulo e o programa principal)
OBJ = inicializar.o atualizar.o metricas.o simular.o main.o

# ============================================================
# Alvo padr√£o: ajuda
# ============================================================
all:
	@echo "=============================================="
	@echo "Uso:"
	@echo "  make O0    -> Compila sem otimiza√ß√£o do compilador"
	@echo "  make O2    -> Compila com otimiza√ß√£o (-O2)"
	@echo "  make clean -> Remove arquivos tempor√°rios"
	@echo "=============================================="

# ============================================================
# Compila√ß√£o SEM otimiza√ß√£o (-O0)
# ============================================================
O0: $(OBJ)
	$(FC) $(FFLAGS_O0) -o $(EXEC_O0) $(OBJ)
	@echo "‚úÖ Compila√ß√£o final (O0) conclu√≠da!"

# ============================================================
# Compila√ß√£o COM otimiza√ß√£o (-O2)
# ============================================================
O2: $(OBJ)
	$(FC) $(FFLAGS_O2) -o $(EXEC_O2) $(OBJ)
	@echo "‚úÖ Compila√ß√£o final (O2) conclu√≠da!"

# ============================================================
# Compila√ß√£o dos m√≥dulos (ordem de depend√™ncia)
# ============================================================
inicializar.o: inicializar.f90
	$(FC) $(FFLAGS_O0) -c inicializar.f90

atualizar.o: atualizar.f90 inicializar.o
	$(FC) $(FFLAGS_O0) -c atualizar.f90

metricas.o: metricas.f90 atualizar.o
	$(FC) $(FFLAGS_O0) -c metricas.f90

simular.o: simular.f90 metricas.o
	$(FC) $(FFLAGS_O0) -c simular.f90

main.o: main.f90 simular.o
	$(FC) $(FFLAGS_O0) -c main.f90

# ============================================================
# Limpeza dos arquivos gerados
# ============================================================
clean:
	rm -f *.o *.mod $(EXEC_O0) $(EXEC_O2) tempos.dat Psh.dat sh.dat gmon.out
	@echo "üßπ Limpeza conclu√≠da!"
# ============================================================
